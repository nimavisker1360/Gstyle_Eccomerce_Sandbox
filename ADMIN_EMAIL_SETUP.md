# راهنمای راه‌اندازی سیستم اطلاع‌رسانی ادمین

## خلاصه

سیستم اطلاع‌رسانی ادمین برای ارسال ایمیل به ادمین پس از هر سفارش جدید پیاده‌سازی شده است.

## ویژگی‌ها

- ✅ ارسال ایمیل به ادمین پس از هر سفارش جدید
- ✅ **لینک مستقیم و قابل کلیک به هر محصول سفارش شده**
- ✅ **نمایش فیلد توضیحات/سوال مشتری برای هر آیتم**
- ✅ نمایش جزئیات کامل سفارش (قیمت، تعداد، سایز، رنگ)
- ✅ دکمه مدیریت سفارش برای دسترسی سریع
- ✅ پشتیبانی از زبان فارسی و طراحی ریسپانسیو

## تنظیمات مورد نیاز

### 1. متغیرهای محیطی

در فایل `.env.local` متغیرهای زیر را اضافه کنید:

```env
# ایمیل ادمین (پیش‌فرض: golnazef1360@gmail.com)
ADMIN_EMAIL=golnazef1360@gmail.com

# نام ادمین (پیش‌فرض: مدیر سیستم)
ADMIN_NAME=مدیر سیستم

# کلید API Resend برای ارسال ایمیل
RESEND_API_KEY=your_resend_api_key_here
```

### 2. فایل‌های ایجاد شده

- `src/lib/constants.ts` - اضافه شدن ثابت‌های ادمین
- `src/emails/admin-order-notification.tsx` - قالب ایمیل ادمین با لینک‌های محصول
- `src/emails/index.tsx` - تابع ارسال ایمیل ادمین
- `src/app/api/payment/zarinpal/verify-payment/route.ts` - ارسال ایمیل ادمین برای زرین‌پال
- `src/lib/actions/order.actions.ts` - ارسال ایمیل ادمین برای PayPal

## نحوه کارکرد

### برای پرداخت‌های زرین‌پال:

1. مشتری سفارش را ثبت می‌کند
2. پرداخت از طریق زرین‌پال انجام می‌شود
3. پس از تایید پرداخت، ایمیل فاکتور برای مشتری ارسال می‌شود
4. **ایمیل اطلاع‌رسانی برای ادمین ارسال می‌شود**

### برای پرداخت‌های PayPal:

1. مشتری سفارش را ثبت می‌کند
2. پرداخت از طریق PayPal انجام می‌شود
3. پس از تایید پرداخت، ایمیل فاکتور برای مشتری ارسال می‌شود
4. **ایمیل اطلاع‌رسانی برای ادمین ارسال می‌شود**

## محتوای ایمیل ادمین

### اطلاعات کلی سفارش:

- شماره سفارش
- تاریخ سفارش
- ایمیل مشتری
- مبلغ کل

### محصولات سفارش شده:

- تصویر محصول
- نام محصول
- تعداد
- قیمت
- سایز (در صورت وجود)
- رنگ (در صورت وجود)
- **توضیحات/سوال مشتری (در صورت وجود)**
- **دکمه "مشاهده محصول" - لینک مستقیم و قابل کلیک به صفحه محصول**

### دکمه‌های عملیاتی:

- **"مشاهده محصول"** - برای هر محصول، لینک مستقیم و قابل کلیک به صفحه محصول
- **"مدیریت سفارش"** - لینک به پنل مدیریت سفارش

### ویژگی‌های جدید:

#### 🔗 لینک‌های قابل کلیک محصولات:

- هر محصول دارای دکمه "مشاهده محصول" است
- کلیک روی دکمه مستقیماً به صفحه محصول هدایت می‌کند
- لینک‌ها از `SERVER_URL` استفاده می‌کنند

#### 💬 فیلد توضیحات/سوال مشتری:

- اگر مشتری برای محصولی توضیحات یا سوالی نوشته باشد، نمایش داده می‌شود
- در کادر زرد رنگ با آیکون 💬 نمایش داده می‌شود
- زیر هر محصول که دارای توضیحات است، پیام "این محصول دارای توضیحات/سوال از مشتری است" نمایش داده می‌شود

## تست سیستم

### 1. تست ایمیل ادمین

برای تست، یک سفارش جدید ثبت کنید و بررسی کنید که:

- ایمیل فاکتور برای مشتری ارسال شود
- ایمیل اطلاع‌رسانی برای ادمین ارسال شود

### 2. بررسی لینک‌ها

- کلیک روی دکمه "مشاهده محصول" باید به صفحه محصول هدایت کند
- کلیک روی دکمه "مدیریت سفارش" باید به پنل مدیریت هدایت کند

### 3. تست فیلد توضیحات

- در سبد خرید، برای محصولی توضیحات بنویسید
- سفارش را تکمیل کنید
- در ایمیل ادمین، توضیحات باید نمایش داده شود

## عیب‌یابی

### مشکل: ایمیل ادمین ارسال نمی‌شود

**راه‌حل:**

1. بررسی کنید که `RESEND_API_KEY` در `.env.local` تنظیم شده باشد
2. بررسی کنید که `ADMIN_EMAIL` در `.env.local` تنظیم شده باشد
3. لاگ‌های سرور را بررسی کنید

### مشکل: لینک‌ها کار نمی‌کنند

**راه‌حل:**

1. بررسی کنید که `SERVER_URL` در `constants.ts` درست تنظیم شده باشد
2. بررسی کنید که مسیرهای محصول و مدیریت درست تعریف شده باشند

### مشکل: توضیحات مشتری نمایش داده نمی‌شود

**راه‌حل:**

1. بررسی کنید که فیلد `note` در مدل سفارش وجود دارد
2. بررسی کنید که در سبد خرید، توضیحات برای محصول نوشته شده باشد
3. بررسی کنید که توضیحات در زمان ثبت سفارش ذخیره می‌شود

## نکات مهم

- ایمیل ادمین به صورت خودکار ارسال می‌شود
- در صورت خطا در ارسال ایمیل ادمین، فرآیند اصلی متوقف نمی‌شود
- تمام متن‌ها به فارسی و با طراحی مناسب هستند
- سیستم از Tailwind CSS برای طراحی استفاده می‌کند
- **لینک‌های محصولات کاملاً قابل کلیک هستند**
- **توضیحات/سوالات مشتری به صورت واضح نمایش داده می‌شوند**

## پشتیبانی

در صورت بروز مشکل، لاگ‌های سرور را بررسی کنید و با تیم توسعه تماس بگیرید.
